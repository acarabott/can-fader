<!DOCTYPE html>
<html>
<head>
  <title>Touch√© Listener</title>
</head>
<body>
</body>
<script src="Gestures.js"></script>
<script src="Touch.js"></script>
<script>
  const socket = new WebSocket('ws://localhost:9999');
  window.onbeforeunload = event => socket.close();

  const gestures = new Gestures();
  const touch = new Touch();
  [gestures, touch].forEach(output => {
    output.canvas.style.border = '1px black solid';
    output.canvas.style.display = 'inline-block';
    output.canvas.style.margin = '10px';
    document.body.appendChild(output.canvas);
  });

  socket.addEventListener('open', event => {
    console.log('socket open');
  });

  socket.addEventListener('message', event => {
    const [type, data] = event.data.split(':');

    if (type === 'm') {
      console.log(data);
    }
    else if (type === 'd') {
      const values = new Float32Array(data.split(',').map(s => parseFloat(s, 10)));
      requestAnimationFrame(() => gestures.update(values));
    }
    else if (type === 't') {
      const values = data.split(',').map(s => parseInt(s, 10));
      requestAnimationFrame(() => touch.update(...values));
    }
  });
</script>
</html>
